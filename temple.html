<!DOCTYPE html>
<html lang="en">

	<head>
		<title>three.js webgl - geometry - cube</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link type="text/css" rel="stylesheet" href="main.css">
	</head>

	<body>

        <script src="threejs/three.js"></script>
		<script src="threejs/OrbitControls.js"></script>
		<script src="threejs/dat.gui.min.js"></script>
		<script src="threejs/ColladaLoader.js"></script>
		<script src="stats.min.js"></script>
		<script src="main.js"></script>


		<script type="module">
			const world = new World();

			var stats = new Stats();
			stats.showPanel( 1 ); // 0: fps, 1: ms, 2: mb, 3+: custom
			document.body.appendChild( stats.dom );
			
			ColladaPart();
			animate();
			world.createSpotLight(1600, 0, 1000);
			world.buildGui();

			fetch('shapes.json')
				.then(res => res.json())
				.then(json => {
					// Add shapes from the JSON

					for (const shape of json) {
						try {
							world.createShape({
								position: shape.position,
								size: shape.size,
								image: shape.image,
								geometry: shape.geometry,
							});
						} catch (e) {
							console.log(e);
						}
					}
				});

			/**
			 * Animate the world
			 */

			function ColladaPart() {
	            const loader = new THREE.ColladaLoader();
	            loader.load( 'Rumba Dancing.dae', function ( collada ) {

	                const animations = collada.animations;
	                const avatar = collada.scene;

	                avatar.traverse( function ( node ) {

	                    if ( node.isSkinnedMesh ) {

	                        node.frustumCulled = false;

	                    }

	                } );

	                const mixer = new THREE.AnimationMixer( avatar );
	                mixer.clipAction( animations[ 0 ] ).play();

	                world.scene.add( avatar );

	                } );

	    	}

			function animate() {
				stats.begin();
				world.renderer.render(world.scene, world.camera);

				world.controls.update();

				const sl = world.spotLight;
				if (sl !== undefined) {
					sl.position.y = (sl.position.y % 1000) + 1;
				}
				stats.end();

				requestAnimationFrame(animate);
			}
			requestAnimationFrame( animate );
		</script>

	</body>

</html>